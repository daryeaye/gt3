<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lost Treasure Pt3 Master Li</title>
  <!-- Load Caveat font for buttons -->
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&display=swap" rel="stylesheet">
  <style>
    /* Global styles */
    body, html {
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #app-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    /* Header styling */
    #header {
      width: 960px;
      background: #eee;
      padding: 10px;
      margin-bottom: 10px;
    }
    /* Container dimensions */
    #container {
      position: relative;
      width: 960px;
      height: 540px;
      border: 1px solid #ccc;
      background: white;
      overflow: hidden;
    }
    #header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    #translation-widget span {
      vertical-align: middle;
    }
    #translation-widget a {
      text-decoration: none;
    }
    .page {
      position: absolute;
      top: 0;
      left: 0;
      width: 960px;
      height: 540px;
      display: none;
      /* Background settings will be applied inline per page */
    }
    .page.active {
      display: block;
    }
    /* Box styling */
    .box {
      position: absolute;
    }
    /* Blue typeable boxes for page 3 (visitorâ€™s pass) */
    input.typeable {
      position: absolute;
      font-family: "Comic Sans MS", sans-serif;
      font-size: 22px;
      border: 1px solid black;
      background: rgba(173,216,230,0.5);
      width: 100%;
      height: 100%;
      box-sizing: border-box;
    }
    /* Gray typeable boxes for pages 4â€“20 */
    input.grayTypeable {
      position: absolute;
      font-family: "Comic Sans MS", sans-serif;
      font-size: 18px;
      border: 1px solid black;
      background: rgba(128,128,128,0.5);
      width: 100%;
      height: 100%;
      box-sizing: border-box;
    }
    /* Progress bar styling in header */
    #progressBar {
      width: 100%;
      background: #ccc;
      height: 20px;
      margin-top: 10px;
    }
    #progress {
      width: 0%;
      background: green;
      height: 100%;
    }
    /* Navigation buttons styling */
    #nav-buttons {
      margin-top: 10px;
    }
    button {
      font-family: "Caveat", cursive;
      font-size: 20px;
      background-color: lightblue;
      border: none;
      padding: 10px 20px;
      margin: 0 5px;
      cursor: pointer;
    }
    /* Styling for the unlock button on page 20 */
    #unlockBtn {
      position: absolute;
      left: 391px;
      top: 420px; /* placed below the textbox (which is at top:373px, height:44px) */
      font-family: "Comic Sans MS", sans-serif;
      font-size: 18px;
      padding: 5px 10px;
      cursor: pointer;
    }
    /* Styling for the clickable box on page 21 */
    .clickable-box {
      position: absolute;
      left: 310px;
      top: 435px;
      width: 370px;
      height: 45px;
      background: rgba(255,255,255,0.5);
      border: 1px solid #000;
      cursor: pointer;
    }
  </style>
  <!-- Include html2canvas library for the widget -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <div id="app-container">
    <!-- Header container with name input, confirm button, and progress bar -->
    <div id="header">
      <div id="header-top">
        <div>
          <input type="text" id="username" placeholder="Enter your name" style="font-size:16px; padding:5px;" />
          <button id="confirmBtn" onclick="confirmName()">Confirm</button>
        </div>

      </div>
      <div id="progressBar">
        <div id="progress"></div>
      </div>
      <span id="progressText">0% completed</span>
    </div>

    <!-- Main container with pages -->
    <div id="container">
      <!-- Page 1 -->
      <div id="page1" class="page active" style="background: url('https://daryeaye.github.io/gt3/3-01.jpg') no-repeat center center; background-size: contain;">
        <!-- Updated external-link boxes -->
        <a href="https://daryeaye.github.io/geotopia/GT1%20Officer+.pdf" target="_blank">
          <div class="box" style="left:12px; top:391px; width:128px; height:112px; border: 1px solid red;"></div>
        </a>
        <a href="https://daryeaye.github.io/geotopia/GT1%20Professor+.pdf" target="_blank">
          <div class="box" style="left:151px; top:391px; width:128px; height:112px; border: 1px solid red;"></div>
        </a>
        <a href="https://daryeaye.github.io/geotopia/GT1%20Hacker+.pdf" target="_blank">
          <div class="box" style="left:290px; top:391px; width:128px; height:112px; border: 1px solid red;"></div>
        </a>
      </div>
      
      <!-- Page 2 -->
      <div id="page2" class="page" style="background: url('https://daryeaye.github.io/gt3/3-02.jpg') no-repeat center center; background-size: contain;"></div>
      
      <!-- Page 3: Visitor's Pass -->
      <div id="page3" class="page" style="background: url('https://daryeaye.github.io/gt3/3-03.jpg') no-repeat center center; background-size: contain;">
        <!-- Big boxes with images (no borders) -->
        <!-- Left Column -->
        <div class="box" style="left:54px; top:31px; width:155px; height:119px;">
          <img id="pic1" src="https://daryeaye.github.io/gt3/ID-1.jpg" style="width:100%; height:100%; display:none;" />
        </div>
        <div class="box" style="left:54px; top:150px; width:155px; height:119px;">
          <img id="pic2" src="https://daryeaye.github.io/gt3/ID-3.jpg" style="width:100%; height:100%; display:none;" />
        </div>
        <div class="box" style="left:54px; top:269px; width:155px; height:119px;">
          <img id="pic3" src="https://daryeaye.github.io/gt3/ID-5.jpg" style="width:100%; height:100%; display:none;" />
        </div>
        <div class="box" style="left:54px; top:388px; width:155px; height:119px;">
          <img id="pic4" src="https://daryeaye.github.io/gt3/ID-7.jpg" style="width:100%; height:100%; display:none;" />
        </div>
        <!-- Right Column -->
        <div class="box" style="left:209px; top:31px; width:155px; height:119px;">
          <img id="pic5" src="https://daryeaye.github.io/gt3/ID-2.jpg" style="width:100%; height:100%; display:none;" />
        </div>
        <div class="box" style="left:209px; top:150px; width:155px; height:119px;">
          <img id="pic6" src="https://daryeaye.github.io/gt3/ID-4.jpg" style="width:100%; height:100%; display:none;" />
        </div>
        <div class="box" style="left:209px; top:269px; width:155px; height:119px;">
          <img id="pic7" src="https://daryeaye.github.io/gt3/ID-6.jpg" style="width:100%; height:100%; display:none;" />
        </div>
        <div class="box" style="left:209px; top:388px; width:155px; height:119px;">
          <img id="pic8" src="https://daryeaye.github.io/gt3/ID-8.jpg" style="width:100%; height:100%; display:none;" />
        </div>
        <!-- Overlaid small blue typeable boxes -->
        <!-- Left Column -->
        <div class="box" style="left:64px; top:96px; width:135px; height:51px;">
          <input type="text" id="answer1" class="typeable" placeholder="Answer" />
        </div>
        <div class="box" style="left:64px; top:216px; width:135px; height:52px;">
          <input type="text" id="answer2" class="typeable" placeholder="Answer" />
        </div>
        <div class="box" style="left:64px; top:336px; width:135px; height:52px;">
          <input type="text" id="answer3" class="typeable" placeholder="Answer" />
        </div>
        <div class="box" style="left:64px; top:452px; width:135px; height:52px;">
          <input type="text" id="answer4" class="typeable" placeholder="Answer" style="font-size:12px;" />
        </div>
        <!-- Right Column -->
        <div class="box" style="left:219px; top:96px; width:136px; height:51px;">
          <input type="text" id="answer5" class="typeable" placeholder="Answer" />
        </div>
        <div class="box" style="left:219px; top:216px; width:136px; height:52px;">
          <input type="text" id="answer6" class="typeable" placeholder="Answer" style="font-size:12px;" />
        </div>
        <div class="box" style="left:219px; top:334px; width:136px; height:52px;">
          <input type="text" id="answer7" class="typeable" placeholder="Answer" />
        </div>
        <div class="box" style="left:219px; top:452px; width:136px; height:52px;">
          <input type="text" id="answer8" class="typeable" placeholder="Answer" />
        </div>
      </div>
      
      <!-- Page 4 -->
      <div id="page4" class="page" style="background: url('https://daryeaye.github.io/gt3/3-04.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:117px; top:106px; width:112px; height:44px;">
          <input type="text" id="p4box1" class="grayTypeable" />
        </div>
        <div class="box" style="left:73px; top:289px; width:56px; height:44px;">
          <input type="text" id="p4box2" class="grayTypeable" />
        </div>
        <div class="box" style="left:302px; top:449px; width:49px; height:44px;">
          <input type="text" id="p4box3" class="grayTypeable" />
        </div>
      </div>
      
      <!-- Page 5 -->
      <div id="page5" class="page" style="background: url('https://daryeaye.github.io/gt3/3-05.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:21px; top:105px; width:169px; height:44px;">
          <input type="text" id="p5box1" class="grayTypeable" />
        </div>
        <div class="box" style="left:21px; top:271px; width:169px; height:44px;">
          <input type="text" id="p5box2" class="grayTypeable" />
        </div>
        <div class="box" style="left:385px; top:439px; width:67px; height:44px;">
          <input type="text" id="p5box3" class="grayTypeable" />
        </div>
      </div>
      
      <!-- Page 6 -->
      <div id="page6" class="page" style="background: url('https://daryeaye.github.io/gt3/3-06.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:427px; top:88px; width:169px; height:44px;">
          <input type="text" id="p6box1" class="grayTypeable" />
        </div>
        <div class="box" style="left:406px; top:394px; width:62px; height:44px;">
          <input type="text" id="p6box2" class="grayTypeable" />
        </div>
      </div>
      
      <!-- Page 7 -->
      <div id="page7" class="page" style="background: url('https://daryeaye.github.io/gt3/3-07.jpg') no-repeat center center; background-size: contain;"></div>
      
      <!-- Page 8 -->
      <div id="page8" class="page" style="background: url('https://daryeaye.github.io/gt3/3-08.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:760px; top:70px; width:178px; height:44px;">
          <input type="text" id="p8box1" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:608px; top:219px; width:108px; height:44px;">
          <input type="text" id="p8box2" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:219px; width:107px; height:44px;">
          <input type="text" id="p8box3" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:272px; width:340px; height:130px;">
          <input type="text" id="p8box4" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:507px; top:411px; width:85px; height:44px;">
          <input type="text" id="p8box5" class="grayTypeable" placeholder="Type here" />
        </div>
      </div>
      
      <!-- Page 9 -->
      <div id="page9" class="page" style="background: url('https://daryeaye.github.io/gt3/3-09.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:760px; top:70px; width:178px; height:44px;">
          <input type="text" id="p9box1" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:608px; top:219px; width:108px; height:44px;">
          <input type="text" id="p9box2" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:219px; width:107px; height:44px;">
          <input type="text" id="p9box3" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:272px; width:340px; height:130px;">
          <input type="text" id="p9box4" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:507px; top:411px; width:85px; height:44px;">
          <input type="text" id="p9box5" class="grayTypeable" placeholder="Type here" />
        </div>
      </div>
      
      <!-- Page 10 -->
      <div id="page10" class="page" style="background: url('https://daryeaye.github.io/gt3/3-10.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:760px; top:70px; width:178px; height:44px;">
          <input type="text" id="p10box1" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:608px; top:219px; width:108px; height:44px;">
          <input type="text" id="p10box2" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:219px; width:107px; height:44px;">
          <input type="text" id="p10box3" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:272px; width:340px; height:130px;">
          <input type="text" id="p10box4" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:507px; top:411px; width:85px; height:44px;">
          <input type="text" id="p10box5" class="grayTypeable" placeholder="Type here" />
        </div>
      </div>
      
      <!-- Page 11 -->
      <div id="page11" class="page" style="background: url('https://daryeaye.github.io/gt3/3-11.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:760px; top:70px; width:178px; height:44px;">
          <input type="text" id="p11box1" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:608px; top:219px; width:108px; height:44px;">
          <input type="text" id="p11box2" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:219px; width:107px; height:44px;">
          <input type="text" id="p11box3" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:272px; width:340px; height:130px;">
          <input type="text" id="p11box4" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:507px; top:411px; width:85px; height:44px;">
          <input type="text" id="p11box5" class="grayTypeable" placeholder="Type here" />
        </div>
      </div>
      
      <!-- Page 12 -->
      <div id="page12" class="page" style="background: url('https://daryeaye.github.io/gt3/3-12.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:760px; top:70px; width:178px; height:44px;">
          <input type="text" id="p12box1" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:608px; top:219px; width:108px; height:44px;">
          <input type="text" id="p12box2" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:219px; width:107px; height:44px;">
          <input type="text" id="p12box3" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:272px; width:340px; height:130px;">
          <input type="text" id="p12box4" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:507px; top:411px; width:85px; height:44px;">
          <input type="text" id="p12box5" class="grayTypeable" placeholder="Type here" />
        </div>
      </div>
      
      <!-- Page 13 -->
      <div id="page13" class="page" style="background: url('https://daryeaye.github.io/gt3/3-13.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:760px; top:70px; width:178px; height:44px;">
          <input type="text" id="p13box1" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:608px; top:219px; width:108px; height:44px;">
          <input type="text" id="p13box2" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:219px; width:107px; height:44px;">
          <input type="text" id="p13box3" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:272px; width:340px; height:130px;">
          <input type="text" id="p13box4" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:507px; top:411px; width:85px; height:44px;">
          <input type="text" id="p13box5" class="grayTypeable" placeholder="Type here" />
        </div>
      </div>
      
      <!-- Page 14 -->
      <div id="page14" class="page" style="background: url('https://daryeaye.github.io/gt3/3-14.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:760px; top:70px; width:178px; height:44px;">
          <input type="text" id="p14box1" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:219px; width:318px; height:44px;">
          <input type="text" id="p14box2" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:272px; width:340px; height:130px;">
          <input type="text" id="p14box3" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:507px; top:411px; width:85px; height:44px;">
          <input type="text" id="p14box4" class="grayTypeable" placeholder="Type here" />
        </div>
      </div>
      
      <!-- Page 15 -->
      <div id="page15" class="page" style="background: url('https://daryeaye.github.io/gt3/3-15.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:760px; top:70px; width:178px; height:44px;">
          <input type="text" id="p15box1" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:219px; width:318px; height:44px;">
          <input type="text" id="p15box2" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:272px; width:340px; height:130px;">
          <input type="text" id="p15box3" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:507px; top:411px; width:85px; height:44px;">
          <input type="text" id="p15box4" class="grayTypeable" placeholder="Type here" />
        </div>
      </div>
      
      <!-- Page 16 -->
      <div id="page16" class="page" style="background: url('https://daryeaye.github.io/gt3/3-16.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:760px; top:70px; width:178px; height:44px;">
          <input type="text" id="p16box1" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:219px; width:318px; height:44px;">
          <input type="text" id="p16box2" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:272px; width:340px; height:130px;">
          <input type="text" id="p16box3" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:507px; top:411px; width:85px; height:44px;">
          <input type="text" id="p16box4" class="grayTypeable" placeholder="Type here" />
        </div>
      </div>
      
      <!-- Page 17 -->
      <div id="page17" class="page" style="background: url('https://daryeaye.github.io/gt3/3-17.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:760px; top:70px; width:178px; height:44px;">
          <input type="text" id="p17box1" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:219px; width:318px; height:44px;">
          <input type="text" id="p17box2" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:272px; width:340px; height:130px;">
          <input type="text" id="p17box3" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:507px; top:411px; width:85px; height:44px;">
          <input type="text" id="p17box4" class="grayTypeable" placeholder="Type here" />
        </div>
      </div>
      
      <!-- Page 18 -->
      <div id="page18" class="page" style="background: url('https://daryeaye.github.io/gt3/3-18.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:760px; top:70px; width:178px; height:44px;">
          <input type="text" id="p18box1" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:219px; width:318px; height:44px;">
          <input type="text" id="p18box2" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:475px; top:272px; width:340px; height:130px;">
          <input type="text" id="p18box3" class="grayTypeable" placeholder="Type here" />
        </div>
        <div class="box" style="left:507px; top:411px; width:85px; height:44px;">
          <input type="text" id="p18box4" class="grayTypeable" placeholder="Type here" />
        </div>
      </div>
      
      <!-- Page 19 -->
      <div id="page19" class="page" style="background: url('https://daryeaye.github.io/gt3/3-19.jpg') no-repeat center center; background-size: contain;"></div>
      
      <!-- Page 20 -->
      <div id="page20" class="page" style="background: url('https://daryeaye.github.io/gt3/3-20.jpg') no-repeat center center; background-size: contain;">
        <div class="box" style="left:391px; top:373px; width:178px; height:44px;">
          <input type="text" id="p20box" class="grayTypeable" placeholder="Type here" />
        </div>
        <button id="unlockBtn" onclick="unlockPage20()">Unlock</button>
      </div>
      
      <!-- Page 21 -->
      <div id="page21" class="page" style="background: url('https://daryeaye.github.io/gt3/3-Final.jpg') no-repeat center center; background-size: contain;">
        <a href="https://daryeaye.github.io/gt3/boshi.html" target="_blank">
          <div class="clickable-box"></div>
        </a>
      </div>
    </div>
    
    <!-- Navigation Buttons -->
    <div id="nav-buttons">
      <button id="prev-btn" onclick="prevPage()">Previous</button>
      <button id="next-btn" onclick="nextPage()">Next</button>
    </div>
  </div>
  
  <script>
    let currentPage = 1;
    const totalPages = 21;
    let maxPageVisited = 1; // track highest page reached
    
    // Expected answers for page 3 (visitor's pass)
    const expectedAnswers = {
      "answer1": "opposite",
      "answer2": "ed",
      "answer3": "adjacent",
      "answer4": "complementary",
      "answer5": "54",
      "answer6": "supplementary",
      "answer7": "180",
      "answer8": "27"
    };
    
    // Check and reveal for page 3 inputs
    function checkAndReveal(answerId, expected, picId) {
      const input = document.getElementById(answerId);
      if (input.value.trim().toLowerCase() === expected) {
        document.getElementById(picId).style.display = "block";
        input.style.display = "none";
        return true;
      }
      return false;
    }
    
    // Set up event listeners for page 3's visitor's pass boxes
    function setupPage3Listeners() {
      for (let [answerId, expected] of Object.entries(expectedAnswers)) {
        const num = answerId.replace("answer", "");
        const picId = "pic" + num;
        document.getElementById(answerId).addEventListener("input", function() {
          checkAndReveal(answerId, expected, picId);
        });
      }
    }
    
    function updateProgress() {
      // Use maxPageVisited so the progress bar never decreases
      const progressPercent = (maxPageVisited / totalPages) * 100;
      document.getElementById('progress').style.width = progressPercent + '%';
      document.getElementById('progressText').innerText = progressPercent.toFixed(0) + '% completed';
    }
    
    function showPage(pageNum) {
      for (let i = 1; i <= totalPages; i++) {
        document.getElementById('page' + i).classList.remove('active');
      }
      document.getElementById('page' + pageNum).classList.add('active');
      
      // Update navigation button visibility
      if (pageNum === 1) {
        document.getElementById("prev-btn").style.display = "none";
        document.getElementById("next-btn").style.display = "inline-block";
      } else if (pageNum === totalPages) {
        document.getElementById("prev-btn").style.display = "inline-block";
        document.getElementById("next-btn").style.display = "none";
      } else {
        document.getElementById("prev-btn").style.display = "inline-block";
        document.getElementById("next-btn").style.display = "inline-block";
      }
      
      updateProgress();
    }
    
    function nextPage() {
      // When moving from page 6 to 7, ensure all 8 visitor's pass images are revealed.
      if (currentPage === 6) {
        for (let i = 1; i <= 8; i++) {
          const pic = document.getElementById("pic" + i);
          if (pic.style.display !== "block") {
            alert("âŒStop. You need the visitor's pass to move on!");
            return;
          }
        }
      }
      
      // For pages 8 to 18, check the very bottom box.
      if (currentPage >= 8 && currentPage <= 18) {
        let inputId = "";
        // For pages 8-13, bottom box is the 5th; for 14-18, it is the 4th.
        if (currentPage <= 13) {
          inputId = "p" + currentPage + "box5";
        } else {
          inputId = "p" + currentPage + "box4";
        }
        const inputElem = document.getElementById(inputId);
        const expectedHouseNumbers = {
          8: "20",
          9: "5",
          10: "29",
          11: "26",
          12: "8",
          13: "19",
          14: "18",
          15: "54",
          16: "20",
          17: "7",
          18: "45"
        };
        if (!inputElem || inputElem.value.trim() !== expectedHouseNumbers[currentPage]) {
          alert("ðŸš« Incorrect house number.");
          return;
        }
      }
      
      // Removed check for page 20 so the next button works without verifying page20's answer
      
      if (currentPage < totalPages) {
        currentPage++;
        if (currentPage > maxPageVisited) {
          maxPageVisited = currentPage;
        }
        showPage(currentPage);
      }
    }
    
    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        showPage(currentPage);
      }
    }
    
    // Function for the Unlock button on page 20
    function unlockPage20() {
      const input = document.getElementById("p20box");
      const val = input.value.trim().toLowerCase();
      if (val === "41.5li") {
        input.style.display = "none";
        window.open("https://daryeaye.github.io/geotopia/bamu.pdf", "_blank");
        currentPage++;  // Advance to page 21
        if (currentPage > maxPageVisited) {
          maxPageVisited = currentPage;
        }
        showPage(currentPage);
      } else if (val === "41.5") {
        alert("âœ…Great! Now ask the Merchant to help.");
      } else {
        alert("â—Nothing happened. Master Li is waiting.");
      }
    }
    
    // Confirm the user's name and disable changes
    function confirmName() {
      const nameInput = document.getElementById("username");
      const name = nameInput.value.trim();
      if (name !== "") {
        localStorage.setItem("username", name);
        nameInput.disabled = true;
        alert("Name confirmed as: " + name);
      } else {
        alert("Please enter a name.");
      }
    }
    
    // Persistence for typeable inputs via localStorage.
    function setupPersistence() {
      // For the username input
      const storedName = localStorage.getItem("username");
      const nameInput = document.getElementById("username");
      if (storedName !== null && storedName !== "") {
        nameInput.value = storedName;
        nameInput.disabled = true;
      }
      
      // For all other text inputs
      const inputs = document.querySelectorAll("input[type='text']");
      inputs.forEach(el => {
        const stored = localStorage.getItem(el.id);
        if (stored !== null) {
          el.value = stored;
          if (expectedAnswers[el.id] && el.value.trim().toLowerCase() === expectedAnswers[el.id]) {
            const num = el.id.replace("answer", "");
            document.getElementById("pic" + num).style.display = "block";
            el.style.display = "none";
          }
        }
        el.addEventListener("input", () => {
          localStorage.setItem(el.id, el.value);
        });
      });
    }
    
    document.addEventListener("DOMContentLoaded", function() {
      showPage(currentPage);
      setupPersistence();
      setupPage3Listeners();
    });
  </script>
  
  <!-- Side Widget: Added without modifying the main code above -->
  <style>
    /* Side widget styling */
    #side-widget {
      position: fixed;
      top: 20px;
      right: 20px; /* Change to left:20px; if you prefer */
      width: 200px;
      height: 200px;
      background: #f9f9f9;
      border: 1px solid #ccc;
      padding: 10px;
      box-sizing: border-box;
      font-family: 'Caveat', cursive;
      z-index: 999;
    }
    #side-widget p.title {
      font-size: 24px;
      text-align: center;
      margin: 0 0 10px;
    }
    #side-widget button,
    #side-widget a {
      display: block;
      margin: 0 auto;
      font-size: 20px;
      cursor: pointer;
      text-align: center;
      background: lightblue;
      border: none;
      padding: 10px;
      text-decoration: none;
      color: inherit;
    }
    /* Selection overlay styles */
    #selection-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      cursor: crosshair;
      z-index: 1000;
    }
    #selection-box {
      position: absolute;
      border: 2px dashed #000;
      background: rgba(0,0,0,0.1);
    }
  </style>
  
  <div id="side-widget">
    <p class="title">Need translation?</p>
    <button id="select-text">Select Text</button>
    <p>
      <a href="https://translate.google.com/?sl=en&tl=es&op=images" target="_blank">
        Click me and paste from clipboard
      </a>
    </p>
  </div>
  
  <script>
    document.getElementById('select-text').addEventListener('click', function() {
      // Create overlay for user selection
      const overlay = document.createElement('div');
      overlay.id = 'selection-overlay';
      document.body.appendChild(overlay);
      
      let startX, startY, selectionBox;
      
      overlay.addEventListener('mousedown', function(e) {
        startX = e.clientX;
        startY = e.clientY;
        
        selectionBox = document.createElement('div');
        selectionBox.id = 'selection-box';
        selectionBox.style.left = startX + 'px';
        selectionBox.style.top = startY + 'px';
        selectionBox.style.width = '0px';
        selectionBox.style.height = '0px';
        overlay.appendChild(selectionBox);
        
        function mouseMoveHandler(e) {
          const currentX = e.clientX;
          const currentY = e.clientY;
          const rectLeft = Math.min(startX, currentX);
          const rectTop = Math.min(startY, currentY);
          const rectWidth = Math.abs(currentX - startX);
          const rectHeight = Math.abs(currentY - startY);
          selectionBox.style.left = rectLeft + 'px';
          selectionBox.style.top = rectTop + 'px';
          selectionBox.style.width = rectWidth + 'px';
          selectionBox.style.height = rectHeight + 'px';
        }
        
        function mouseUpHandler(e) {
          overlay.removeEventListener('mousemove', mouseMoveHandler);
          overlay.removeEventListener('mouseup', mouseUpHandler);
          
          const boxRect = selectionBox.getBoundingClientRect();
          document.body.removeChild(overlay);
          
          // Target the content area you wish to capture. Using #container from the main code.
          const target = document.getElementById('container');
          const targetRect = target.getBoundingClientRect();
          
          // Use html2canvas to capture the target element
          html2canvas(target, { useCORS: true, allowTaint: false }).then(canvas => {
            // Calculate scale factor for accurate cropping
            const scaleFactor = canvas.width / targetRect.width;
            const sx = (boxRect.left - targetRect.left) * scaleFactor;
            const sy = (boxRect.top - targetRect.top) * scaleFactor;
            const sWidth = boxRect.width * scaleFactor;
            const sHeight = boxRect.height * scaleFactor;
            
            const croppedCanvas = document.createElement('canvas');
            croppedCanvas.width = sWidth;
            croppedCanvas.height = sHeight;
            const ctx = croppedCanvas.getContext('2d');
            ctx.drawImage(canvas, sx, sy, sWidth, sHeight, 0, 0, sWidth, sHeight);
            
            // Copy the cropped image to the clipboard
            croppedCanvas.toBlob(blob => {
              if (blob) {
                const item = new ClipboardItem({ 'image/png': blob });
                navigator.clipboard.write([item]).then(() => {
                  alert('Screenshot copied to clipboard.');
                }).catch(err => {
                  console.error('Failed to copy screenshot to clipboard', err);
                  alert('Failed to copy screenshot to clipboard.');
                });
              }
            });
          });
        }
        
        overlay.addEventListener('mousemove', mouseMoveHandler);
        overlay.addEventListener('mouseup', mouseUpHandler);
      });
    });
  </script>
</body>
</html>
